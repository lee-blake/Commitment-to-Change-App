<div class="container-fluid text-center">
    {% if commitment_template.statistics.derived_commitments.statuses.counts.total == 0 %}
        No commitments have been made from this template.
    {% else %}
        <h2>Statistics for 
            {{ commitment_template.statistics.derived_commitments.statuses.counts.total }}
             derived commitments
        </h2>
        <script src="https://d3js.org/d3.v6.min.js"></script>
        
    <div id="status-breakdown-chart">
    </div>
    

    <script>
        // Set up data for the pie chart. In the future, this should be passed in.

        const data = [
        {
            count: {{ commitment_template.statistics.derived_commitments.statuses.counts.in_progress }},
            label: "~" + {{ commitment_template.statistics.derived_commitments.statuses.percentages.in_progress }}.toFixed(2) + "%",
            color: '#8FC3D4',
            legend: "In-progress: " + {{ commitment_template.statistics.derived_commitments.statuses.counts.in_progress }} + " (~" +
            {{ commitment_template.statistics.derived_commitments.statuses.percentages.in_progress }}.toFixed(2) + "%)",
        },
        { 
            count: {{ commitment_template.statistics.derived_commitments.statuses.counts.complete }},
            label: "~" + {{ commitment_template.statistics.derived_commitments.statuses.percentages.complete }}.toFixed(2) + "%",
            color: '#7CC487',
            legend: "Complete: " + {{ commitment_template.statistics.derived_commitments.statuses.counts.complete }} + " (~" +
            {{ commitment_template.statistics.derived_commitments.statuses.percentages.complete }}.toFixed(2) + "%)",
        },
        {
            count: {{ commitment_template.statistics.derived_commitments.statuses.counts.discontinued }},
            label: "~" + {{commitment_template.statistics.derived_commitments.statuses.percentages.discontinued}}.toFixed(2) + "%",
            color: '#717171',
            legend: "Discontinued: " + {{commitment_template.statistics.derived_commitments.statuses.counts.discontinued}} + " (~" +
            {{commitment_template.statistics.derived_commitments.statuses.percentages.discontinued}}.toFixed(2) + "%)",
        },
        { 
            count: {{ commitment_template.statistics.derived_commitments.statuses.counts.expired }},
            label: "~" +{{commitment_template.statistics.derived_commitments.statuses.percentages.expired}}.toFixed(2) + "%",
            color: '#E27E7A',
            legend: "Past-due: " + {{commitment_template.statistics.derived_commitments.statuses.counts.expired}} + " (~" +
            {{commitment_template.statistics.derived_commitments.statuses.percentages.expired}}.toFixed(2) + "%)",
        },
        ];

        const cleanData = removeEmptyData(data);
        document.addEventListener("DOMContentLoaded", () => generatePieChart(cleanData, "#status-breakdown-chart"));

        function removeEmptyData(data){
            let cleanData = data.slice();
            for (let i = cleanData.length - 1; i >= 0; i--) {
                if (cleanData[i].count === 0) {
                    cleanData.splice(i, 1);
                }
            }
            return cleanData;
        }
    </script>
    {% endif %}
</div>